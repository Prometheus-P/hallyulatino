{
  "name": "ì‹ ê·œ ì½˜í…ì¸  ì•Œë¦¼ ì›Œí¬í”Œë¡œìš°",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "new-content",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-new-content",
      "name": "Webhook - ì‹ ê·œ ì½˜í…ì¸ ",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "operation": "select",
        "tableId": "subscriptions",
        "filterType": "string",
        "filterString": "status=eq.active&preferences->>content_type=eq.{{ $json.content_type }}"
      },
      "id": "get-subscribers",
      "name": "Supabase - êµ¬ë…ì ì¡°íšŒ",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [470, 300],
      "credentials": {
        "supabaseApi": {
          "id": "supabase-api",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "batchSize": 100,
        "options": {}
      },
      "id": "split-batches",
      "name": "ë°°ì¹˜ ë¶„í• ",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [690, 300]
    },
    {
      "parameters": {
        "fromEmail": "noreply@hallyulatino.com",
        "toEmail": "={{ $json.email }}",
        "subject": "=ğŸ¬ ìƒˆë¡œìš´ {{ $('Webhook - ì‹ ê·œ ì½˜í…ì¸ ').item.json.content_type }} ì½˜í…ì¸ ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!",
        "emailType": "html",
        "html": "=<h1>{{ $('Webhook - ì‹ ê·œ ì½˜í…ì¸ ').item.json.title }}</h1>\n<p>{{ $('Webhook - ì‹ ê·œ ì½˜í…ì¸ ').item.json.description }}</p>\n<a href=\"https://hallyulatino.com/content/{{ $('Webhook - ì‹ ê·œ ì½˜í…ì¸ ').item.json.content_id }}\">ì§€ê¸ˆ ì‹œì²­í•˜ê¸°</a>",
        "options": {}
      },
      "id": "send-email",
      "name": "ì´ë©”ì¼ ë°œì†¡",
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2.1,
      "position": [910, 300],
      "credentials": {
        "smtp": {
          "id": "smtp-credentials",
          "name": "SMTP"
        }
      }
    },
    {
      "parameters": {
        "operation": "insert",
        "tableId": "notifications",
        "dataToSend": "defineBelow",
        "fieldsToSend": {
          "mappingMode": "defineBelow",
          "values": [
            {
              "fieldName": "user_id",
              "fieldValue": "={{ $json.user_id }}"
            },
            {
              "fieldName": "type",
              "fieldValue": "new_content"
            },
            {
              "fieldName": "content_id",
              "fieldValue": "={{ $('Webhook - ì‹ ê·œ ì½˜í…ì¸ ').item.json.content_id }}"
            },
            {
              "fieldName": "title",
              "fieldValue": "={{ $('Webhook - ì‹ ê·œ ì½˜í…ì¸ ').item.json.title }}"
            },
            {
              "fieldName": "sent_at",
              "fieldValue": "={{ new Date().toISOString() }}"
            }
          ]
        }
      },
      "id": "log-notification",
      "name": "Supabase - ì•Œë¦¼ ë¡œê·¸",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [1130, 300],
      "credentials": {
        "supabaseApi": {
          "id": "supabase-api",
          "name": "Supabase API"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"success\": true,\n  \"notifications_sent\": {{ $('ë°°ì¹˜ ë¶„í• ').item.json.length || 0 }}\n}",
        "options": {}
      },
      "id": "respond-webhook",
      "name": "Webhook ì‘ë‹µ",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1350, 300]
    }
  ],
  "connections": {
    "Webhook - ì‹ ê·œ ì½˜í…ì¸ ": {
      "main": [
        [
          {
            "node": "Supabase - êµ¬ë…ì ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - êµ¬ë…ì ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "ë°°ì¹˜ ë¶„í• ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë°°ì¹˜ ë¶„í• ": {
      "main": [
        [
          {
            "node": "ì´ë©”ì¼ ë°œì†¡",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Webhook ì‘ë‹µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì´ë©”ì¼ ë°œì†¡": {
      "main": [
        [
          {
            "node": "Supabase - ì•Œë¦¼ ë¡œê·¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Supabase - ì•Œë¦¼ ë¡œê·¸": {
      "main": [
        [
          {
            "node": "ë°°ì¹˜ ë¶„í• ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "name": "ì•Œë¦¼",
      "createdAt": "2025-11-25T00:00:00.000Z",
      "updatedAt": "2025-11-25T00:00:00.000Z"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-11-25T00:00:00.000Z",
  "versionId": "1"
}
