---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allNoticias = await getCollection('noticias', ({ data }) => !data.draft);
const noticias = allNoticias.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const categories = ['drama', 'kpop', 'cine', 'cultura', 'general'];
---

<BaseLayout
  title="Noticias de K-Drama, K-Pop y Cultura Coreana"
  description="Las últimas noticias del mundo del entretenimiento coreano. K-Dramas, K-Pop, cine coreano y más, todo en español."
>
  <section class="bg-gradient-to-r from-rose-500 to-orange-500 text-white">
    <div class="mx-auto max-w-7xl px-4 py-12 sm:px-6 lg:px-8">
      <h1 class="text-3xl font-bold sm:text-4xl">Noticias</h1>
      <p class="mt-2 text-lg text-rose-100">
        Las últimas novedades del mundo del entretenimiento coreano
      </p>
    </div>
  </section>

  <section class="py-12">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <!-- Category Filter -->
      <div class="mb-8 flex flex-wrap gap-2">
        <a
          href="/noticias"
          class="rounded-full bg-pink-600 px-4 py-2 text-sm font-medium text-white"
        >
          Todas
        </a>
        {categories.map((cat) => (
          <a
            href={`/noticias/categoria/${cat}`}
            class="rounded-full bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200 transition-colors capitalize"
          >
            {cat}
          </a>
        ))}
      </div>

      {noticias.length > 0 ? (
        <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {noticias.map((noticia) => (
            <article class="group rounded-lg border border-gray-200 bg-white overflow-hidden shadow-sm hover:shadow-md transition-shadow">
              {noticia.data.heroImage && (
                <img
                  src={noticia.data.heroImage}
                  alt={noticia.data.heroImageAlt || noticia.data.title}
                  class="h-48 w-full object-cover"
                  loading="lazy"
                />
              )}
              <div class="p-5">
                <div class="flex items-center gap-2 mb-3">
                  <span class="inline-block rounded-full bg-rose-100 px-3 py-1 text-xs font-medium text-rose-800 capitalize">
                    {noticia.data.category}
                  </span>
                  {noticia.data.breaking && (
                    <span class="inline-block rounded-full bg-red-600 px-3 py-1 text-xs font-medium text-white">
                      Urgente
                    </span>
                  )}
                </div>
                <h2 class="text-lg font-semibold text-gray-900 group-hover:text-pink-600 line-clamp-2">
                  <a href={`/noticias/${noticia.slug}`}>
                    {noticia.data.title}
                  </a>
                </h2>
                <p class="mt-2 text-sm text-gray-600 line-clamp-2">
                  {noticia.data.description}
                </p>
                <time class="mt-3 block text-xs text-gray-500" datetime={noticia.data.pubDate.toISOString()}>
                  {noticia.data.pubDate.toLocaleDateString('es-419', { year: 'numeric', month: 'long', day: 'numeric' })}
                </time>
              </div>
            </article>
          ))}
        </div>
      ) : (
        <div class="text-center py-12">
          <p class="text-gray-600">Próximamente: noticias del mundo del entretenimiento coreano</p>
        </div>
      )}
    </div>
  </section>
</BaseLayout>
